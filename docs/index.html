<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>FreeFinder Wien - Gratis Deals & Rabatte</title>
    <meta name="description" content="Entdecke 200+ Gratis-Deals, Freebies & Rabatte in Wien! TÃ¤glich aktualisiert.">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #e8f4f8 0%, #d0e8f0 100%);
            min-height: 100vh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        .container { max-width: 800px; margin: 0 auto; padding: 16px; }
        header { text-align: center; padding: 20px 0 10px; }
        h1 { font-size: 28px; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .subtitle { color: #666; font-size: 14px; margin-top: 4px; }
        .stats { display: flex; justify-content: center; gap: 20px; margin-top: 12px; font-size: 13px; color: #888; }
        .search-box { background: white; border-radius: 14px; padding: 14px 18px; display: flex; align-items: center; gap: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin: 16px 0; }
        .search-box input { flex: 1; border: none; outline: none; font-size: 16px; background: transparent; }
        .search-box svg { width: 20px; height: 20px; color: #999; }
        .filters { background: white; border-radius: 20px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin-bottom: 16px; }
        .filter-row { display: flex; gap: 8px; overflow-x: auto; padding: 4px 0; scrollbar-width: none; -ms-overflow-style: none; }
        .filter-row::-webkit-scrollbar { display: none; }
        .filter-btn { padding: 10px 16px; border-radius: 25px; border: none; background: #f1f5f9; color: #334155; font-size: 14px; font-weight: 600; cursor: pointer; white-space: nowrap; transition: all 0.2s; display: flex; align-items: center; gap: 6px; }
        .filter-btn:hover { background: #e2e8f0; }
        .filter-btn.active { background: #3b82f6; color: white; }
        .filter-btn.active-dark { background: #1e293b; color: white; }
        .filter-divider { height: 1px; background: #e5e7eb; margin: 12px 0; }
        .filter-count { background: rgba(0,0,0,0.1); padding: 2px 8px; border-radius: 10px; font-size: 12px; }
        .filter-btn.active .filter-count { background: rgba(255,255,255,0.25); }
        .deals { display: flex; flex-direction: column; gap: 14px; }
        .deal-card { background: white; border-radius: 16px; padding: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border: 2px solid transparent; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; text-decoration: none; color: inherit; display: block; }
        .deal-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .deal-card.hot { border-color: #ef4444; }
        .deal-card.gratis { border-color: #10b981; }
        .deal-card.rabatt { border-color: #f59e0b; }
        .deal-card.code { border-color: #8b5cf6; }
        .deal-header { display: flex; align-items: flex-start; gap: 12px; margin-bottom: 12px; }
        .deal-logo { width: 48px; height: 48px; border-radius: 12px; background: linear-gradient(135deg, #f8fafc, #f1f5f9); display: flex; align-items: center; justify-content: center; font-size: 24px; flex-shrink: 0; }
        .deal-meta { flex: 1; min-width: 0; }
        .deal-brand { font-weight: 600; font-size: 14px; }
        .deal-source { font-size: 12px; color: #888; }
        .deal-badges { display: flex; gap: 6px; flex-wrap: wrap; }
        .badge { padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 700; color: white; }
        .badge-hot { background: #ef4444; }
        .badge-new { background: #06b6d4; }
        .badge-gratis { background: #10b981; }
        .badge-rabatt { background: #f59e0b; }
        .badge-testabo { background: #3b82f6; }
        .badge-code { background: #8b5cf6; }
        .deal-title { font-size: 16px; font-weight: 700; margin-bottom: 6px; line-height: 1.3; }
        .deal-desc { font-size: 14px; color: #666; line-height: 1.4; margin-bottom: 12px; }
        .deal-footer { display: flex; justify-content: space-between; align-items: center; }
        .deal-expires { font-size: 12px; color: #888; display: flex; align-items: center; gap: 4px; }
        .deal-cta { color: #3b82f6; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 4px; }
        .vote-section { display: flex; align-items: center; gap: 8px; margin-top: 12px; padding-top: 12px; border-top: 1px solid #f1f5f9; }
        .vote-btn { background: #f1f5f9; border: none; border-radius: 8px; padding: 6px 12px; cursor: pointer; display: flex; align-items: center; gap: 4px; font-size: 14px; transition: all 0.2s; }
        .vote-btn:hover { background: #e2e8f0; }
        .vote-btn.upvoted { background: #dcfce7; color: #16a34a; }
        .vote-btn.downvoted { background: #fee2e2; color: #dc2626; }
        .vote-count { font-weight: 600; font-size: 14px; min-width: 30px; text-align: center; }
        .vote-count.positive { color: #16a34a; }
        .vote-count.negative { color: #dc2626; }
        .code-display { background: #faf5ff; border: 2px dashed #8b5cf6; border-radius: 8px; padding: 8px 12px; margin: 8px 0; display: flex; justify-content: space-between; align-items: center; }
        .code-text { font-family: monospace; font-weight: 700; color: #7c3aed; font-size: 14px; }
        .code-copy { background: #8b5cf6; color: white; border: none; border-radius: 6px; padding: 4px 10px; font-size: 12px; cursor: pointer; }
        .code-copy:hover { background: #7c3aed; }
        .empty { text-align: center; padding: 60px 20px; color: #666; }
        .empty-icon { font-size: 48px; margin-bottom: 12px; }
        .loading { text-align: center; padding: 40px; color: #666; }
        .install-banner { background: linear-gradient(135deg, #667eea, #764ba2); color: white; padding: 14px 16px; border-radius: 14px; display: none; align-items: center; justify-content: space-between; margin-bottom: 16px; }
        .install-banner button { background: white; color: #667eea; border: none; padding: 8px 16px; border-radius: 8px; font-weight: 600; cursor: pointer; }
        @media (max-width: 480px) { h1 { font-size: 24px; } .filter-btn { padding: 8px 12px; font-size: 13px; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ FreeFinder Wien</h1>
            <p class="subtitle">TÃ¤glich aktualisierte Gratis-Deals & Rabatte</p>
            <div class="stats">
                <span id="dealCount">0 Deals</span>
                <span id="lastUpdate">LÃ¤dt...</span>
            </div>
        </header>
        <div class="install-banner" id="installBanner">
            <span>ğŸ“± Als App installieren</span>
            <button onclick="installApp()">Installieren</button>
        </div>
        <div class="search-box">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
            <input type="text" id="searchInput" placeholder="Suche z.B. Kaffee, IKEA, gratis...">
        </div>
        <div class="filters">
            <div class="filter-row" id="typeFilters">
                <button class="filter-btn active" data-filter="alle">ğŸ¯ Alle <span class="filter-count" id="countAll">0</span></button>
                <button class="filter-btn" data-filter="gratis">ğŸ Gratis <span class="filter-count" id="countGratis">0</span></button>
                <button class="filter-btn" data-filter="rabatt">ğŸ’° Rabatt <span class="filter-count" id="countRabatt">0</span></button>
                <button class="filter-btn" data-filter="codes">ğŸ·ï¸ Codes <span class="filter-count" id="countCodes">0</span></button>
                <button class="filter-btn" data-filter="neu">âœ¨ Neu <span class="filter-count" id="countNeu">0</span></button>
            </div>
            <div class="filter-divider"></div>
            <div class="filter-row" id="categoryFilters">
                <button class="filter-btn active-dark" data-category="alle">ğŸ¯ Alle</button>
                <button class="filter-btn" data-category="essen">ğŸ” Essen</button>
                <button class="filter-btn" data-category="kaffee">â˜• Kaffee</button>
                <button class="filter-btn" data-category="supermarkt">ğŸ›’ Supermarkt</button>
                <button class="filter-btn" data-category="beauty">ğŸ’‡ Beauty</button>
                <button class="filter-btn" data-category="fitness">ğŸ’ª Fitness</button>
                <button class="filter-btn" data-category="reisen">âœˆï¸ Reisen</button>
                <button class="filter-btn" data-category="codes">ğŸ·ï¸ Rabattcodes</button>
                <button class="filter-btn" data-category="shopping">ğŸ›ï¸ Shopping</button>
                <button class="filter-btn" data-category="technik">ğŸ“± Technik</button>
                <button class="filter-btn" data-category="streaming">ğŸ“º Streaming</button>
                <button class="filter-btn" data-category="mobilitÃ¤t">ğŸšŒ MobilitÃ¤t</button>
                <button class="filter-btn" data-category="wien">ğŸ›ï¸ Wien</button>
                <button class="filter-btn" data-category="finanzen">ğŸ’³ Finanzen</button>
                <button class="filter-btn" data-category="mode">ğŸ‘• Mode</button>
            </div>
        </div>
        <div class="deals" id="dealsList"><div class="loading">â³ Lade Deals...</div></div>
    </div>
    <script>
        let allDeals = [], currentFilter = 'alle', currentCategory = 'alle', searchQuery = '';
        let votes = JSON.parse(localStorage.getItem('dealVotes') || '{}'), deferredPrompt;

        async function loadDeals() {
            try {
                const response = await fetch('deals.json?t=' + Date.now());
                const data = await response.json();
                allDeals = data.deals;
                allDeals.forEach(deal => { deal.votes = votes[deal.id] || 0; });
                updateCounts();
                document.getElementById('lastUpdate').textContent = 'Aktualisiert: ' + new Date(data.lastUpdated).toLocaleString('de-AT', {day:'2-digit',month:'2-digit',hour:'2-digit',minute:'2-digit'});
                renderDeals();
            } catch (e) { document.getElementById('dealsList').innerHTML = '<div class="empty"><div class="empty-icon">ğŸ˜•</div><p>Fehler beim Laden</p></div>'; }
        }

        function updateCounts() {
            document.getElementById('countAll').textContent = allDeals.length;
            document.getElementById('countGratis').textContent = allDeals.filter(d => d.type === 'gratis' || d.type === 'testabo').length;
            document.getElementById('countRabatt').textContent = allDeals.filter(d => d.type === 'rabatt').length;
            document.getElementById('countCodes').textContent = allDeals.filter(d => d.category === 'codes' || d.code).length;
            document.getElementById('countNeu').textContent = allDeals.filter(d => d.isNew).length;
            document.getElementById('dealCount').textContent = allDeals.length + ' Deals';
        }

        function filterDeals() {
            let f = [...allDeals];
            if (currentFilter === 'gratis') f = f.filter(d => d.type === 'gratis' || d.type === 'testabo');
            else if (currentFilter === 'rabatt') f = f.filter(d => d.type === 'rabatt');
            else if (currentFilter === 'codes') f = f.filter(d => d.category === 'codes' || d.code);
            else if (currentFilter === 'neu') f = f.filter(d => d.isNew);
            if (currentCategory !== 'alle') f = f.filter(d => d.category === currentCategory);
            if (searchQuery) { const q = searchQuery.toLowerCase(); f = f.filter(d => d.title.toLowerCase().includes(q) || d.description.toLowerCase().includes(q) || d.brand.toLowerCase().includes(q) || (d.code && d.code.toLowerCase().includes(q))); }
            f.sort((a, b) => { if ((b.votes||0) !== (a.votes||0)) return (b.votes||0) - (a.votes||0); if ((a.priority||99) !== (b.priority||99)) return (a.priority||99) - (b.priority||99); return b.hot ? 1 : -1; });
            return f;
        }

        function vote(id, dir, e) { e.preventDefault(); e.stopPropagation(); const d = allDeals.find(x => x.id === id); if (!d) return; const c = votes[id] || 0; votes[id] = dir === 'up' ? (c === 1 ? 0 : 1) : (c === -1 ? 0 : -1); d.votes = votes[id]; localStorage.setItem('dealVotes', JSON.stringify(votes)); renderDeals(); }

        function copyCode(code, e) { e.preventDefault(); e.stopPropagation(); navigator.clipboard.writeText(code); e.target.textContent = 'âœ“ Kopiert!'; setTimeout(() => e.target.textContent = 'Kopieren', 1500); }

        function renderDeals() {
            const f = filterDeals(), c = document.getElementById('dealsList');
            if (!f.length) { c.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ˜•</div><p>Keine Deals gefunden</p></div>'; return; }
            c.innerHTML = f.map(d => {
                const v = votes[d.id] || 0, vc = v > 0 ? 'positive' : v < 0 ? 'negative' : '', up = v === 1 ? 'upvoted' : '', dn = v === -1 ? 'downvoted' : '';
                let cc = 'deal-card'; if (d.hot) cc += ' hot'; else if (d.type === 'gratis') cc += ' gratis'; else if (d.category === 'codes' || d.code) cc += ' code'; else if (d.type === 'rabatt') cc += ' rabatt';
                let code = ''; if (d.code && !['In App','Per Email','Auto-aktiviert'].includes(d.code)) code = `<div class="code-display"><span class="code-text">${d.code}</span><button class="code-copy" onclick="copyCode('${d.code}',event)">Kopieren</button></div>`;
                return `<a href="${d.url}" target="_blank" rel="noopener" class="${cc}"><div class="deal-header"><div class="deal-logo">${d.logo||'ğŸ'}</div><div class="deal-meta"><div class="deal-brand">${d.brand}</div><div class="deal-source">${d.source}</div></div><div class="deal-badges">${d.hot?'<span class="badge badge-hot">ğŸ”¥ HOT</span>':''}${d.isNew?'<span class="badge badge-new">âœ¨ NEU</span>':''}${d.code?'<span class="badge badge-code">CODE</span>':''}<span class="badge badge-${d.type}">${d.type.toUpperCase()}</span></div></div><div class="deal-title">${d.title}</div><div class="deal-desc">${d.description}</div>${code}<div class="deal-footer"><div class="deal-expires">ğŸ•’ ${d.expires||'Unbegrenzt'}</div><div class="deal-cta">Zum Deal â†’</div></div><div class="vote-section" onclick="event.preventDefault()"><button class="vote-btn ${up}" onclick="vote('${d.id}','up',event)">ğŸ‘</button><span class="vote-count ${vc}">${v>0?'+':''}${v}</span><button class="vote-btn ${dn}" onclick="vote('${d.id}','down',event)">ğŸ‘</button><span style="margin-left:auto;font-size:12px;color:#888;">${d.distance||''}</span></div></a>`;
            }).join('');
        }

        document.getElementById('searchInput').addEventListener('input', e => { searchQuery = e.target.value; renderDeals(); });
        document.getElementById('typeFilters').addEventListener('click', e => { if (e.target.classList.contains('filter-btn')) { document.querySelectorAll('#typeFilters .filter-btn').forEach(b => b.classList.remove('active')); e.target.classList.add('active'); currentFilter = e.target.dataset.filter; renderDeals(); }});
        document.getElementById('categoryFilters').addEventListener('click', e => { if (e.target.classList.contains('filter-btn')) { document.querySelectorAll('#categoryFilters .filter-btn').forEach(b => b.classList.remove('active-dark')); e.target.classList.add('active-dark'); currentCategory = e.target.dataset.category; renderDeals(); }});
        window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); deferredPrompt = e; document.getElementById('installBanner').style.display = 'flex'; });
        function installApp() { if (deferredPrompt) { deferredPrompt.prompt(); deferredPrompt.userChoice.then(() => { deferredPrompt = null; document.getElementById('installBanner').style.display = 'none'; }); }}
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js');
        loadDeals();
    </script>
</body>
</html>
