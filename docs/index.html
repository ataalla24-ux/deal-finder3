<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="FreeFinder">
  <meta name="theme-color" content="#e8f4f8">
  <meta name="description" content="Entdecke 100+ Gratis-Deals, Freebies & Rabatte in Wien. T√§glich aktualisiert!">
  
  <title>üéÅ FreeFinder Wien - Gratis Deals & Freebies</title>
  
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.svg">
  <link rel="icon" type="image/svg+xml" href="icon-192.svg">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg: linear-gradient(135deg, #e8f4f8 0%, #d0e8f0 100%);
      --card: #ffffff;
      --text: #1a1a2e;
      --text-secondary: #64748b;
      --accent: #3b82f6;
      --gratis: #10b981;
      --rabatt: #f59e0b;
      --cashback: #8b5cf6;
      --hot: #ef4444;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      min-height: 100vh;
      color: var(--text);
      padding-bottom: env(safe-area-inset-bottom);
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 16px;
      padding-top: calc(16px + env(safe-area-inset-top));
    }
    
    /* Header */
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    .header h1 {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .header p {
      color: var(--text-secondary);
      font-size: 14px;
      margin-top: 4px;
    }
    
    /* Search */
    .search-box {
      background: var(--card);
      border-radius: 14px;
      padding: 14px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      margin-bottom: 16px;
    }
    .search-box svg { color: #9ca3af; flex-shrink: 0; width: 20px; height: 20px; }
    .search-box input {
      border: none;
      outline: none;
      font-size: 17px;
      width: 100%;
      background: transparent;
    }
    
    /* Filter Section */
    .filter-section {
      background: var(--card);
      border-radius: 20px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    }
    
    .type-filters, .category-filters {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding-bottom: 8px;
      scrollbar-width: none;
      -ms-overflow-style: none;
    }
    .type-filters::-webkit-scrollbar, .category-filters::-webkit-scrollbar { display: none; }
    
    .filter-btn, .cat-btn {
      flex-shrink: 0;
      padding: 10px 16px;
      border-radius: 25px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      background: #f1f5f9;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .filter-btn:hover, .cat-btn:hover { background: #e2e8f0; }
    .filter-btn.active { background: var(--accent); color: white; }
    .filter-btn[data-type="gratis"].active { background: var(--gratis); }
    .filter-btn[data-type="rabatt"].active { background: var(--rabatt); }
    .filter-btn[data-type="cashback"].active { background: var(--cashback); }
    .cat-btn.active { background: #1e293b; color: white; }
    
    .filter-count {
      background: rgba(0,0,0,0.1);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 12px;
    }
    .filter-btn.active .filter-count, .cat-btn.active .filter-count {
      background: rgba(255,255,255,0.25);
    }
    
    .divider {
      height: 1px;
      background: #e2e8f0;
      margin: 12px 0;
    }
    
    /* Stats */
    .stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding: 0 4px;
    }
    .stats-count { font-weight: 700; font-size: 16px; }
    .stats-updated { font-size: 12px; color: var(--text-secondary); }
    
    /* Deals Grid */
    .deals-grid {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    
    /* Deal Card */
    .deal-card {
      background: var(--card);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 2px 12px rgba(0,0,0,0.06);
      border: 2px solid transparent;
      transition: all 0.2s;
      cursor: pointer;
    }
    .deal-card:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
    .deal-card.hot { border-color: var(--hot); }
    .deal-card.gratis { border-color: var(--gratis); }
    .deal-card.rabatt { border-color: var(--rabatt); }
    
    .deal-header {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 12px;
    }
    .deal-logo {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0;
    }
    .deal-brand { font-weight: 600; font-size: 14px; }
    .deal-source { font-size: 12px; color: var(--text-secondary); }
    
    .deal-badges {
      display: flex;
      gap: 6px;
      margin-left: auto;
      flex-wrap: wrap;
      justify-content: flex-end;
    }
    .badge {
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
    }
    .badge.hot { background: var(--hot); color: white; }
    .badge.new { background: #06b6d4; color: white; }
    .badge.gratis { background: var(--gratis); color: white; }
    .badge.rabatt { background: var(--rabatt); color: white; }
    .badge.cashback { background: var(--cashback); color: white; }
    .badge.testabo { background: #3b82f6; color: white; }
    
    .deal-title {
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 6px;
      line-height: 1.3;
    }
    .deal-desc {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.4;
      margin-bottom: 12px;
    }
    
    .deal-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .deal-meta {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      color: var(--text-secondary);
    }
    .deal-link {
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--accent);
      font-weight: 600;
      font-size: 14px;
      text-decoration: none;
    }
    
    /* Loading & Empty */
    .loading, .empty-state {
      text-align: center;
      padding: 60px 20px;
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #e2e8f0;
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    /* PWA Install Banner */
    .install-banner {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 16px;
      border-radius: 12px;
      margin-bottom: 16px;
      display: none;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .install-banner.show { display: flex; }
    .install-banner p { font-size: 14px; font-weight: 500; }
    .install-banner button {
      background: white;
      color: #667eea;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
    }
    .install-close {
      background: transparent !important;
      color: white !important;
      padding: 4px !important;
      font-size: 18px !important;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>üéÅ FreeFinder Wien</h1>
      <p>T√§glich aktualisierte Gratis-Deals & Rabatte</p>
    </header>
    
    <!-- Install Banner -->
    <div class="install-banner" id="installBanner">
      <p>üì± Als App installieren!</p>
      <button id="installBtn">Installieren</button>
      <button class="install-close" id="closeInstall">‚úï</button>
    </div>
    
    <!-- Search -->
    <div class="search-box">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
      <input type="text" id="searchInput" placeholder="Suche z.B. Kaffee, IKEA, gratis...">
    </div>
    
    <!-- Filters -->
    <div class="filter-section">
      <div class="type-filters" id="typeFilters">
        <button class="filter-btn active" data-type="alle">üéØ Alle <span class="filter-count" id="countAll">0</span></button>
        <button class="filter-btn" data-type="gratis">üéÅ Gratis <span class="filter-count" id="countGratis">0</span></button>
        <button class="filter-btn" data-type="rabatt">üí∞ Rabatt <span class="filter-count" id="countRabatt">0</span></button>
        <button class="filter-btn" data-type="cashback">ü§ë Cashback <span class="filter-count" id="countCashback">0</span></button>
        <button class="filter-btn" data-type="neu">‚ú® Neu <span class="filter-count" id="countNeu">0</span></button>
      </div>
      
      <div class="divider"></div>
      
      <div class="category-filters" id="categoryFilters">
        <button class="cat-btn active" data-cat="alle">üéØ Alle</button>
        <button class="cat-btn" data-cat="essen">üçî Essen</button>
        <button class="cat-btn" data-cat="kaffee">‚òï Kaffee</button>
        <button class="cat-btn" data-cat="supermarkt">üõí Supermarkt</button>
        <button class="cat-btn" data-cat="beauty">üíá Beauty</button>
        <button class="cat-btn" data-cat="wien">üèõÔ∏è Wien</button>
        <button class="cat-btn" data-cat="technik">üì± Technik</button>
        <button class="cat-btn" data-cat="shopping">üõçÔ∏è Shopping</button>
        <button class="cat-btn" data-cat="streaming">üì∫ Streaming</button>
        <button class="cat-btn" data-cat="mobilit√§t">üöå Mobilit√§t</button>
        <button class="cat-btn" data-cat="finanzen">üí≥ Finanzen</button>
        <button class="cat-btn" data-cat="mode">üëï Mode</button>
      </div>
    </div>
    
    <!-- Stats -->
    <div class="stats">
      <span class="stats-count" id="dealsCount">L√§dt...</span>
      <span class="stats-updated" id="lastUpdated"></span>
    </div>
    
    <!-- Deals -->
    <div class="deals-grid" id="dealsGrid">
      <div class="loading">
        <div class="spinner"></div>
        <p>Deals werden geladen...</p>
      </div>
    </div>
  </div>
  
  <script>
    let allDeals = [];
    let currentType = 'alle';
    let currentCategory = 'alle';
    let searchQuery = '';
    
    // Load Deals
    async function loadDeals() {
      try {
        const response = await fetch('deals.json?' + Date.now());
        const data = await response.json();
        allDeals = data.deals || [];
        
        updateCounts();
        renderDeals();
        
        document.getElementById('lastUpdated').textContent = 
          'Aktualisiert: ' + new Date(data.lastUpdated).toLocaleString('de-AT', { 
            day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' 
          });
      } catch (error) {
        document.getElementById('dealsGrid').innerHTML = 
          '<div class="empty-state"><p>üòï Deals konnten nicht geladen werden</p></div>';
      }
    }
    
    // Update Filter Counts
    function updateCounts() {
      document.getElementById('countAll').textContent = allDeals.length;
      document.getElementById('countGratis').textContent = allDeals.filter(d => d.type === 'gratis' || d.type === 'testabo').length;
      document.getElementById('countRabatt').textContent = allDeals.filter(d => d.type === 'rabatt').length;
      document.getElementById('countCashback').textContent = allDeals.filter(d => d.type === 'cashback').length;
      document.getElementById('countNeu').textContent = allDeals.filter(d => d.isNew).length;
    }
    
    // Filter Deals
    function filterDeals() {
      let filtered = [...allDeals];
      
      // Type filter
      if (currentType === 'gratis') {
        filtered = filtered.filter(d => d.type === 'gratis' || d.type === 'testabo');
      } else if (currentType === 'rabatt') {
        filtered = filtered.filter(d => d.type === 'rabatt');
      } else if (currentType === 'cashback') {
        filtered = filtered.filter(d => d.type === 'cashback');
      } else if (currentType === 'neu') {
        filtered = filtered.filter(d => d.isNew);
      }
      
      // Category filter
      if (currentCategory !== 'alle') {
        filtered = filtered.filter(d => d.category === currentCategory);
      }
      
      // Search filter
      if (searchQuery) {
        const q = searchQuery.toLowerCase();
        filtered = filtered.filter(d => 
          d.title.toLowerCase().includes(q) ||
          d.description.toLowerCase().includes(q) ||
          d.brand.toLowerCase().includes(q)
        );
      }
      
      return filtered;
    }
    
    // Render Deals
    function renderDeals() {
      const filtered = filterDeals();
      const grid = document.getElementById('dealsGrid');
      
      document.getElementById('dealsCount').textContent = `${filtered.length} Deals`;
      
      if (filtered.length === 0) {
        grid.innerHTML = '<div class="empty-state"><p>üòï Keine Deals gefunden</p><p style="color:#64748b;font-size:14px;margin-top:8px;">Versuche andere Filter</p></div>';
        return;
      }
      
      grid.innerHTML = filtered.map(deal => `
        <div class="deal-card ${deal.hot ? 'hot' : deal.type}" onclick="window.open('${deal.url}', '_blank')">
          <div class="deal-header">
            <div class="deal-logo">${deal.logo || 'üéÅ'}</div>
            <div>
              <div class="deal-brand">${deal.brand}</div>
              <div class="deal-source">${deal.source}</div>
            </div>
            <div class="deal-badges">
              ${deal.hot ? '<span class="badge hot">üî• HOT</span>' : ''}
              ${deal.isNew ? '<span class="badge new">‚ú® NEU</span>' : ''}
              <span class="badge ${deal.type}">${deal.type.toUpperCase()}</span>
            </div>
          </div>
          <div class="deal-title">${deal.title}</div>
          <div class="deal-desc">${deal.description}</div>
          <div class="deal-footer">
            <div class="deal-meta">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
              ${deal.expires || 'Unbegrenzt'}
            </div>
            <span class="deal-link">Zum Deal ‚Üí</span>
          </div>
        </div>
      `).join('');
    }
    
    // Event Listeners
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentType = btn.dataset.type;
        renderDeals();
      });
    });
    
    document.querySelectorAll('.cat-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCategory = btn.dataset.cat;
        renderDeals();
      });
    });
    
    document.getElementById('searchInput').addEventListener('input', (e) => {
      searchQuery = e.target.value;
      renderDeals();
    });
    
    // PWA Install
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      if (!localStorage.getItem('installDismissed')) {
        document.getElementById('installBanner').classList.add('show');
      }
    });
    
    document.getElementById('installBtn')?.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
        document.getElementById('installBanner').classList.remove('show');
      }
    });
    
    document.getElementById('closeInstall')?.addEventListener('click', () => {
      document.getElementById('installBanner').classList.remove('show');
      localStorage.setItem('installDismissed', 'true');
    });
    
    // Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
    
    // Init
    loadDeals();
  </script>
</body>
</html>
